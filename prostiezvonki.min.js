!function(t){"use strict";var n,o,e;!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);window.btoa||(window.btoa=function(n){var o,e,r,i,s,c;for(r=n.length,e=0,o="";r>e;){if(i=255&n.charCodeAt(e++),e==r){o+=t.charAt(i>>2),o+=t.charAt((3&i)<<4),o+="==";break}if(s=n.charCodeAt(e++),e==r){o+=t.charAt(i>>2),o+=t.charAt((3&i)<<4|(240&s)>>4),o+=t.charAt((15&s)<<2),o+="=";break}c=n.charCodeAt(e++),o+=t.charAt(i>>2),o+=t.charAt((3&i)<<4|(240&s)>>4),o+=t.charAt((15&s)<<2|(192&c)>>6),o+=t.charAt(63&c)}return o}),window.atob||(window.atob=function(t){var o,e,r,i,s,c,u;for(c=t.length,s=0,u="";c>s;){do{o=n[255&t.charCodeAt(s++)]}while(c>s&&-1==o);if(-1==o)break;do{e=n[255&t.charCodeAt(s++)]}while(c>s&&-1==e);if(-1==e)break;u+=String.fromCharCode(o<<2|(48&e)>>4);do{if(61==(r=255&t.charCodeAt(s++)))return u;r=n[r]}while(c>s&&-1==r);if(-1==r)break;u+=String.fromCharCode((15&e)<<4|(60&r)>>2);do{if(61==(i=255&t.charCodeAt(s++)))return u;i=n[i]}while(c>s&&-1==i);if(-1==i)break;u+=String.fromCharCode((3&r)<<6|i)}return u})}(),(o=function(){this.type=null}).prototype.isTransfer=function(){return"1"===this.type},o.prototype.isIncoming=function(){return"2"===this.type},o.prototype.isHistory=function(){return"4"===this.type},o.prototype.isOutcoming=function(){return"8"===this.type},o.prototype.isOutcomingAnswer=function(){return"16"===this.type},o.prototype.isIncomingAnswer=function(){return"32"===this.type},o.prototype.isSmsSent=function(){return"128"===this.type},o.prototype.isSmsStatus=function(){return"256"===this.type},(e=function(n,o){o||(n=atob(n)),n=n.split("\0").shift().trim(),this.body=t(function(t){var n=null;if(window.DOMParser)try{n=(new DOMParser).parseFromString(t,"text/xml")}catch(t){n=null}else if(window.ActiveXObject)try{(n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(t)||(n=null)}catch(t){n=null}return n}(n))}).prototype.getEvents=function(){var n=[];return this.body.find("Event").each(function(){var e=new o;t.each(this.attributes,function(t,n){e[n.name]=n.value.trim()}),n.push(e)}),n},e.prepareRequest=function(t,n,o){var e="<Request><ProtocolVersion>1</ProtocolVersion><Method>"+t+"</Method><RequestID>0</RequestID><Data>"+n+"</Data></Request>";return o||(e=btoa(e)),e},n=function(){var t="",n=null,o=null,r=!1,i={};this.APPLICATION_ERRORS={4001:{ru:"Ошибка проверки лицензионного ключа (4001)"},4002:{ru:"Лицензионный ключ недействителен (4002)"},4003:{ru:"Истек срок использования лицензионного ключа (4003)"},4004:{ru:"Лицензионный ключ не подходит для этого типа АТС-коннектора (4004)"},4005:{ru:"Лицензионный ключ не подходит для этой версии АТС-коннектора (4005)"},4006:{ru:"Нет лицензии на подключение этой CRM системы (4006)"},4007:{ru:"Превышено максимальное допустимое количество пользователей (4007)"},4008:{ru:"Ошибка авторизации (4008)"},4009:{ru:"Соединение прервано из-за подключения пользователя с таким же добавочным номером (4009)"}},this.version="1.6.3",this.setUserPhone=function(n){t=n},this.connect=function(s){var c,u,a;if(c=s.host,u="10150",a="ws",null===c.match(/:\d+$/)&&(c=c+":"+u),null===c.match(/^wss?p?:\/\//)&&(c=a+"://"+c),r=0===(o=c).indexOf("wss"),s.client_id&&s.client_id.length>32)return{result:"error",text:"Password exceeds max length of 32"};t=s.user_phone||t;var h,f=o+"?CID="+(h=s.client_id,btoa(h||""))+"&CT="+s.client_type+"&GID="+t+"&PhoneNumber="+t+"&BroadcastEventsMask=0&BroadcastGroup="+(s.broadcast_group||"")+"&PzProtocolVersion=2";return(n=new WebSocket(f)).onopen=function(t){this===n&&i.onConnect&&"function"==typeof i.onConnect&&i.onConnect(t)},n.onclose=function(t){this===n&&i.onDisconnect&&"function"==typeof i.onDisconnect&&i.onDisconnect(t)},n.onerror=function(t){this===n&&(console.log(t),i.onError&&"function"==typeof i.onError&&i.onError(t))},n.onmessage=function(t){if(this===n){var o,s;if(void 0===t.data)return!1;for(s=new e(t.data,r).getEvents(),o=0;o<s.length;o+=1)i.onEvent&&"function"==typeof i.onEvent&&i.onEvent(s[o])}},{result:"ok"}},this.disconnect=function(){n&&n.close(),n=null},this.isConnected=function(){return n&&1===n.readyState},this.onConnect=function(t){i.onConnect=t},this.onDisconnect=function(t){i.onDisconnect=t},this.onError=function(t){i.onError=t},this.onEvent=function(t){i.onEvent=t},this.call=function(o){n&&n.send(e.prepareRequest("Call","<From>"+t+"</From><To>"+o+"</To>",r))},this.sms=function(o,i){n&&n.send(e.prepareRequest("Generate","<Event>128</Event><From>"+t+"</From><To>"+o+"</To><Smstext>"+i+"</Smstext>",r))},this.transfer=function(t,o){n&&n.send(e.prepareRequest("Transfer","<CallID>"+t+"</CallID><To>"+(o||"")+"</To>",r))}},window.pz=window.prostiezvonki=new n}(jQuery);
